---
- name: "Add git PPA"
  apt_repository: "repo='ppa:git-core/ppa' update_cache=yes"

- name: "Install git latest"
  apt: "pkg=git state=latest"

- name: "Install dev tools"
  apt: "pkg={{ item }} state=present"
  with_items:
      - "exuberant-ctags"
      - "silversearcher-ag"
      - "ruby"
      - "vim"
      - "zsh"

- name: "Check tmux version"
  command: "tmux -V"
  register: "tmux_version"
  changed_when: false

- name: "Create {{ username }} group"
  group: "name={{ username }} state=present"

- name: "Create {{ username }} user"
  user: "name={{ username }} group={{ username }} shell=/usr/bin/zsh"

- name: "Add {{ username }} to sudoers"
  lineinfile: "dest=/etc/sudoers state=present line='{{ username }} ALL=(ALL) NOPASSWD: ALL'"

- name: "Create .ssh directory"
  file: "path=/home/{{ username }}/apps state=directory owner={{ username }} group={{ username }} mode=0700"

- name: "Add public key to authorized_keys"
  lineinfile: "dest=/home/{{ username }}/.ssh/authorized_keys line={{ public_key }} state=present create=yes"

- name: "Create apps directory"
  file: "path=/home/{{ username }}/apps state=directory owner={{ username }} group={{ username }}"

- name: "Clone dotfiles"
  git: "repo=https://github.com/jswinarton/dotfiles.git
       dest=/home/{{ username }}/apps/dotfiles
       update=no"
  become: "yes"
  become_user: "{{ username }}"

- name: "Symlink dotfiles"
  command: "/home/{{ username }}/apps/dotfiles/setup/symlink_dotfiles.sh chdir=/home/{{ username }}/apps/dotfiles/setup creates=/home/{{ username }}/.commonrc"
  become: "yes"
  become_user: "{{ username }}"

- name: "Clone oh-my-zsh"
  git: "repo=https://github.com/robbyrussell/oh-my-zsh.git
       dest=/home/{{ username }}/.oh-my-zsh
       update=no"
  become: "yes"
  become_user: "{{ username }}"

- name: "Clone vundle"
  git: "repo=https://github.com/VundleVim/Vundle.vim.git
       dest=/home/{{ username }}/.vim/bundle/Vundle.vim
       update=no"
  become: "yes"
  become_user: "{{ username }}"

- name: "Install vundle plugins"
  command: "vim +PluginInstall +qall creates=/home/{{ username }}/.vim/bundle/ctrlp.vim"
  become: "yes"
  become_user: "{{ username }}"

